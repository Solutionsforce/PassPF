{% extends "base.html" %}

{% block content %}
<div class="title">
    Nova solicitação de passaporte
</div>

<div class="protocolo-container">
    <div class="protocolo-header">
        <div class="protocolo-logo">
            <img src="https://employer.com.br/wp-content/uploads/2022/06/Lei-do-PIS.png" alt="Brasão da República" width="65" height="65">
        </div>
        <div class="protocolo-title">
            <h1>Protocolo de Solicitação<br>de Documento de Viagem</h1>
        </div>
    </div>

    <div class="protocolo-info-row">
        <div class="protocolo-info-cell">
            <span class="protocolo-info-label">Tipo de Documento de Viagem:</span><br>
            PASSAPORTE COMUM - ICAO
        </div>
        <div class="protocolo-info-cell">
            <span class="protocolo-info-label">Emissão do Protocolo:</span><br>
            {{ data_emissao }}
        </div>
    </div>

    <div class="protocolo-numero-section">
        <span>Protocolo: {{ protocolo }}</span>
    </div>

    <div class="protocolo-download-section">
        <a href="{{ url_for('download_protocolo') }}" class="btn-download-protocolo">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            BAIXAR PROTOCOLO (PDF)
        </a>
    </div>

    <div class="protocolo-dados-section">
        <div class="protocolo-dados-title">Dados da Solicitação</div>
        <div class="protocolo-dados-content">
            <div class="protocolo-label">Requerente:</div>
            
            <div class="protocolo-dados-row">
                <div class="protocolo-field">
                    <span class="protocolo-label">Nome Completo:</span>
                    {{ dados_pessoais.get('nome', '').upper() }}
                </div>
            </div>
            
            <div class="protocolo-dados-row">
                <div class="protocolo-field">
                    <span class="protocolo-label">Sexo:</span>
                    {{ dados_pessoais.get('sexo', '').capitalize() }}
                </div>
                <div class="protocolo-field">
                    <span class="protocolo-label">Data de Nascimento:</span>
                    {{ dados_pessoais.get('data_nascimento', '') }}
                </div>
            </div>
            
            <div class="protocolo-dados-row">
                <div class="protocolo-field">
                    <span class="protocolo-label">País de Nascimento:</span>
                    {{ dados_pessoais.get('pais', '') }}
                </div>
            </div>
            
            <div class="protocolo-dados-row">
                <div class="protocolo-field">
                    <span class="protocolo-label">UF de Nascimento:</span>
                    {{ dados_pessoais.get('uf', '') }}
                </div>
            </div>
            
            <div class="protocolo-dados-row">
                <div class="protocolo-field">
                    <span class="protocolo-label">Cidade de Nascimento:</span>
                    {{ dados_pessoais.get('cidade', '') }}
                </div>
            </div>
            
            <div class="protocolo-dados-row">
                <div class="protocolo-field">
                    <span class="protocolo-label">País de Nacionalidade:</span>
                    {{ dados_pessoais.get('nacionalidade', '') }}
                </div>
            </div>
            
            <div class="protocolo-endereco">
                <span class="protocolo-label">Endereço:</span>
                {{ dados_complementares.get('logradouro', '').upper() }} - {{ dados_complementares.get('bairro', '').upper() }} - {{ dados_complementares.get('cidade_endereco', '').upper() }}/{{ dados_complementares.get('uf_endereco', '').upper() }} - BRASIL<br>
                CEP: {{ dados_complementares.get('cep', '') }}
            </div>
        </div>
    </div>

    <div class="protocolo-info-important">
        <div class="protocolo-info-important-title">INFORMAÇÕES IMPORTANTES:</div>
        - Caso o documento de viagem não seja retirado no prazo de 90 (noventa) dias, contados a partir da confirmação de pedido de passaporte no posto da PF, o mesmo será cancelado;<br>
        - A solicitação de passaporte preenchida eletronicamente e não confirmada, no posto da PF, em até 90 (noventa) dias será cancelada automaticamente;<br>
        - Os documentos apresentados poderão ser recusados se o tempo de expedição e/ou o mau estado de conservação impossibilitarem a identificação do requerente;<br>
        - O simples agendamento e/ou recibo bancário não comprova o pagamento da taxa;<br>
        - Para crianças menores de 3 anos de idade deverá ser apresentada 1(uma) fotografia facial, tamanho 5X7, recente, colorida, sem data e em fundo branco.<br>
        - Em algumas unidades é obrigatório o agendamento prévio do atendimento pelo site www.dpf.gov.br.<br>
        - Comparecer ao Posto de Atendimento do Departamento de Polícia Federal, munido deste protocolo e de documentos originais, para validação e coleta de foto, impressões digitais e assinatura.
    </div>
</div>

<div class="agendamento-container">
    <div class="agendamento-title">Selecione a Unidade de Atendimento</div>
    <div class="agendamento-subtitle">Unidades mais próximas ao seu endereço (CEP: {{ dados_complementares.get('cep', '') }})</div>
    
    <form method="POST" action="{{ url_for('protocolo') }}" id="formAgendamento">
        {% if unidades %}
            {% for unidade in unidades %}
            <div class="unidade-card">
                <input type="radio" name="unidade_id" id="unidade_{{ unidade.id }}" value="{{ unidade.id }}" required>
                <label for="unidade_{{ unidade.id }}" class="unidade-label">
                    <div class="unidade-orgao">{{ unidade.orgao }}</div>
                    <div class="unidade-nome">{{ unidade.nome }}</div>
                    <div class="unidade-endereco">{{ unidade.endereco }}</div>
                    <div class="unidade-cidade">{{ unidade.cidade }}/{{ unidade.uf }} - CEP: {{ unidade.cep }}</div>
                    <div class="unidade-telefone">Tel: {{ unidade.telefone }}</div>
                </label>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-unidades">Nenhuma unidade encontrada para o CEP informado.</div>
        {% endif %}
        
        <div class="agendamento-datetime">
            <div class="form-group">
                <label class="form-label required" for="data_agendamento">Selecione a Data:</label>
                <select class="form-select" id="data_agendamento" name="data_agendamento" required>
                    <option value="" disabled selected>Selecione uma data</option>
                    {% for data in datas %}
                    <option value="{{ data }}">{{ data | replace('-', '/') }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label required" for="horario_agendamento">Selecione o Horário:</label>
                <select class="form-select" id="horario_agendamento" name="horario_agendamento" required>
                    <option value="" disabled selected>Selecione um horário</option>
                    {% for horario in horarios %}
                    <option value="{{ horario }}">{{ horario }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div id="resumo-agendamento" class="resumo-agendamento-container" style="display: none;">
            <div class="resumo-agendamento-titulo">Resumo do Agendamento</div>
            <div class="resumo-agendamento-conteudo">
                <div class="resumo-item">
                    <span class="resumo-label">Unidade de Atendimento:</span>
                    <span id="resumo-unidade" class="resumo-valor">-</span>
                </div>
                <div class="resumo-item">
                    <span class="resumo-label">Data do Atendimento:</span>
                    <span id="resumo-data" class="resumo-valor">-</span>
                </div>
                <div class="resumo-item">
                    <span class="resumo-label">Horário do Atendimento:</span>
                    <span id="resumo-horario" class="resumo-valor">-</span>
                </div>
            </div>
        </div>
        
        <div class="declaracoes-container">
            <div class="declaracao-item">
                <input type="checkbox" id="declaracao_comparecimento" name="declaracao_comparecimento" required>
                <label for="declaracao_comparecimento">
                    Declaro que <strong>comparecerei na data e horário agendados</strong> portando <strong>todos os documentos necessários e corretos</strong> para emissão do passaporte.
                </label>
            </div>
            
            <div class="declaracao-item">
                <input type="checkbox" id="declaracao_pagamento" name="declaracao_pagamento" required>
                <label for="declaracao_pagamento">
                    Estou ciente que após a emissão da GRU de pagamento via PIX, <strong>devo efetuar o pagamento dentro de 30 minutos</strong>. O <strong style="color: #d32f2f;">não pagamento gerará bloqueio na emissão do passaporte</strong>.
                </label>
            </div>
        </div>
        
        <div class="button-group-center">
            <button type="submit" class="btn-primary">EMITIR GRU PASSAPORTE</button>
        </div>
    </form>
    
    <div class="documentacao-container">
        <h3 class="documentacao-titulo">Documentação essencial para todos os solicitantes</h3>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Documento de identificação:</div>
            <div class="documentacao-item-texto">Original e com foto recente que permita a plena identificação do titular. Exemplos incluem RG, Carteira de Trabalho e Previdência Social (CTPS), Carteira Nacional de Habilitação (CNH) ou passaporte anterior.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">CPF:</div>
            <div class="documentacao-item-texto">Pode estar incluso no documento de identificação apresentado (RG, CNH), ou pode ser apresentado como um documento separado. Se não possuir, será necessário emitir o Comprovante de Situação Cadastral no CPF.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Certidão de nascimento:</div>
            <div class="documentacao-item-texto">Se o solicitante for menor de 12 anos, este documento pode ser usado no lugar do RG.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Comprovante de quitação eleitoral:</div>
            <div class="documentacao-item-texto">Para maiores de 18 anos, é necessário estar em dia com as obrigações eleitorais.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Documento militar:</div>
            <div class="documentacao-item-texto">Para homens entre 18 e 45 anos, é preciso apresentar o Certificado de Reservista ou outro documento militar válido.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Certidão de casamento:</div>
            <div class="documentacao-item-texto">Necessária em caso de alteração do nome devido ao casamento.</div>
        </div>
        
        <h4 class="documentacao-subtitulo">Documentos adicionais</h4>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Passaporte anterior:</div>
            <div class="documentacao-item-texto">Se possuir, é obrigatório apresentá-lo. Caso não o apresente por extravio, furto ou roubo, deverá ser informado no formulário online e o valor da taxa do novo passaporte será dobrado.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Fotografia 5x7:</div>
            <div class="documentacao-item-texto">Para menores de 5 anos, a foto colorida, recente e de fundo branco é obrigatória no dia da entrevista.</div>
        </div>
        
        <div class="documentacao-item">
            <div class="documentacao-item-titulo">Autorização para menores:</div>
            <div class="documentacao-item-texto">Para menores de 18 anos, a autorização de ambos os pais ou responsáveis legais é obrigatória.</div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const unidadeRadios = document.querySelectorAll('input[name="unidade_id"]');
    const dataSelect = document.getElementById('data_agendamento');
    const horarioSelect = document.getElementById('horario_agendamento');
    const resumoContainer = document.getElementById('resumo-agendamento');
    const resumoUnidade = document.getElementById('resumo-unidade');
    const resumoData = document.getElementById('resumo-data');
    const resumoHorario = document.getElementById('resumo-horario');
    
    let unidadeSelecionada = null;
    let dataSelecionada = null;
    let horarioSelecionado = null;
    
    function atualizarResumo() {
        if (unidadeSelecionada && dataSelecionada && horarioSelecionado) {
            resumoContainer.style.display = 'block';
        }
    }
    
    unidadeRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            const label = this.nextElementSibling;
            const orgao = label.querySelector('.unidade-orgao').textContent;
            const nome = label.querySelector('.unidade-nome').textContent;
            const endereco = label.querySelector('.unidade-endereco').textContent;
            const cidade = label.querySelector('.unidade-cidade').textContent;
            
            unidadeSelecionada = orgao + ' - ' + nome + ', ' + endereco + ', ' + cidade;
            resumoUnidade.textContent = unidadeSelecionada;
            atualizarResumo();
        });
    });
    
    dataSelect.addEventListener('change', function() {
        dataSelecionada = this.value;
        const dataFormatada = dataSelecionada.split('-').reverse().join('/');
        resumoData.textContent = dataFormatada;
        atualizarResumo();
    });
    
    horarioSelect.addEventListener('change', function() {
        horarioSelecionado = this.value;
        resumoHorario.textContent = horarioSelecionado;
        atualizarResumo();
    });
});
</script>

{% endblock %}
